rule Linux_Credential_Access
{
    meta:
        description = "Detect access to /etc/passwd, /etc/shadow, or shadow-like hash containers"
        author = "Louis"

    strings:
        // Linux system password files
        $passwd = "/etc/passwd"
        $shadow = "/etc/shadow"

        // Variations attackers sometimes use
        $shadow_bak  = "shadow.bak"
        $shadow_old  = "shadow-"
        $passwd_old  = "passwd-"

        // Credential-reading functions found in malware
        $fopen  = "fopen"
        $read   = "read("
        $open   = "open("

    condition:
        // Binary contains credential file references AND file-access APIs
        any of ($passwd, $shadow, $shadow_bak, $shadow_old, $passwd_old)
        and any of ($fopen, $read, $open)
}
